From be109fa4c3cc23cd519b835b1528852d555ee34f Mon Sep 17 00:00:00 2001
From: vamsikrishnak <vamsikrishnak@ami.com>
Date: Wed, 23 Aug 2023 14:51:13 +0530
Subject: [PATCH] Fixed Apache Benchmark tool timeout issue

Signed-off-by: vamsikrishnak <vamsikrishnak@ami.com>
---
 http/http_connection.hpp | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/http/http_connection.hpp b/http/http_connection.hpp
index d1834f1..954ceee 100644
--- a/http/http_connection.hpp
+++ b/http/http_connection.hpp
@@ -610,7 +610,20 @@ class Connection :
                 BMCWEB_LOG_DEBUG << this << " from write(1)";
                 return;
             }
-
+            if (res.keepAlive()){
+                std::error_code reqEc;
+                crow::Request& Req = req.emplace(parser->release(), reqEc);
+                if (reqEc)
+                {
+                    BMCWEB_LOG_DEBUG << "Request failed to construct" << reqEc;
+                    return;
+                }
+                // close the request connection from HTTP 1.0
+                if(Req.version() == 10){
+                    close();
+                    return;
+                }
+            }
             serializer.reset();
             BMCWEB_LOG_DEBUG << this << " Clearing response";
             res.clear();
-- 
2.9.5

