From 601a7f239e9eb72e2df1acca0d9516cb2875d3ea Mon Sep 17 00:00:00 2001
From: prasannas <prasannas@ami.com>
Date: Wed, 20 Dec 2023 20:08:45 +0530
Subject: [PATCH 162/162] While Patch DHCPv4 and DHCPv6 Attribute throw 500
 Internal server error

---
 redfish-core/lib/ethernet.hpp | 21 +++++++++------------
 1 file changed, 9 insertions(+), 12 deletions(-)

diff --git a/redfish-core/lib/ethernet.hpp b/redfish-core/lib/ethernet.hpp
index d24a411..866218f 100644
--- a/redfish-core/lib/ethernet.hpp
+++ b/redfish-core/lib/ethernet.hpp
@@ -1259,7 +1259,8 @@ inline void handleDHCPPatch(const std::string& ifaceId,
     {
         if (*v4dhcpParms.useDnsServers != *v6dhcpParms.useDnsServers)
         {
-            messages::generalError(asyncResp->res);
+            messages::propertyValueConflict(
+                asyncResp->res, "DHCPv4.UseDNSServers", "DHCPv6.UseDNSServers");
             return;
         }
         nextDNS = *v4dhcpParms.useDnsServers;
@@ -1282,7 +1283,8 @@ inline void handleDHCPPatch(const std::string& ifaceId,
     {
         if (*v4dhcpParms.useNtpServers != *v6dhcpParms.useNtpServers)
         {
-            messages::generalError(asyncResp->res);
+            messages::propertyValueConflict(
+                asyncResp->res, "DHCPv4.UseNTPServers", "DHCPv6.UseNTPServers");
             return;
         }
         nextNTP = *v4dhcpParms.useNtpServers;
@@ -1305,7 +1307,8 @@ inline void handleDHCPPatch(const std::string& ifaceId,
     {
         if (*v4dhcpParms.useDomainName != *v6dhcpParms.useDomainName)
         {
-            messages::generalError(asyncResp->res);
+            messages::propertyValueConflict(
+                asyncResp->res, "DHCPv4.UseDomainName", "DHCPv6.UseDomainName");
             return;
         }
         nextUseDomain = *v4dhcpParms.useDomainName;
@@ -2427,11 +2430,6 @@ inline void handleEthernetInterfaceInstancePatch(
                         messages::propertyValueConflict(asyncResp->res, "DHCPv4.DHCPEnabled","IPv4StaticAddresses");
                         return;
                     }
-                    if(ipv4AddressValid)
-                    {
-                    handleDHCPPatch(ifaceId, ethData, v4dhcpParms, v6dhcpParms, ipv6AcceptRA,
-                            asyncResp);
-                    }
                 }
             }
 
@@ -2452,14 +2450,13 @@ inline void handleEthernetInterfaceInstancePatch(
                             return;
                         }
                     }
-
-                    if(ipv6AddressValid)
+                }
+            }
+            if(ipv6AddressValid && ipv4AddressValid)
                     {
                         handleDHCPPatch(ifaceId, ethData, v4dhcpParms, v6dhcpParms, ipv6AcceptRA,
                             asyncResp);
                     }
-                }
-            }
         }
 
         if (hostname)
-- 
2.9.5

