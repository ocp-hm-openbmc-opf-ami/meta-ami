From 6ab8f57bf7c6081a54568f0354002d1a1a555fe9 Mon Sep 17 00:00:00 2001
From: prasannas <prasannas@ami.com>
Date: Mon, 3 Jul 2023 11:56:27 +0530
Subject: [PATCH 78/78] Fix for invalid IPv6StaticAddresses error Message

---
 redfish-core/include/error_messages.hpp                |  3 +++
 .../include/registries/base_message_registry.hpp       | 18 ++++++++++++++++--
 redfish-core/lib/ethernet.hpp                          |  8 ++++----
 redfish-core/src/error_messages.cpp                    | 11 +++++++++++
 4 files changed, 34 insertions(+), 6 deletions(-)

diff --git a/redfish-core/include/error_messages.hpp b/redfish-core/include/error_messages.hpp
index 816d6e9..660dde2 100644
--- a/redfish-core/include/error_messages.hpp
+++ b/redfish-core/include/error_messages.hpp
@@ -1089,6 +1089,9 @@ nlohmann::json invalidQueryFilter();
 
 void invalidQueryFilter(crow::Response& res);
 
+nlohmann::json invalidip(std::string_view arg1,std::string_view arg2);
+void invalidip(crow::Response& res, std::string_view arg1,std::string_view arg2);
+
 } // namespace messages
 
 } // namespace redfish
diff --git a/redfish-core/include/registries/base_message_registry.hpp b/redfish-core/include/registries/base_message_registry.hpp
index 382e11a..eab6e1f 100644
--- a/redfish-core/include/registries/base_message_registry.hpp
+++ b/redfish-core/include/registries/base_message_registry.hpp
@@ -1246,7 +1246,20 @@ constexpr std::array registry =
                 "string",
             },
             "Correct the value for the property in the request body and resubmit the request if the operation failed.",
-        }}
+        }},
+    MessageEntry{
+	    "InvalidIP",
+	    {
+		"Indicates that a given IP address is invalid",
+		"The Requested IP address  is invalid",
+		"warning",
+		2,
+		{
+			"string"
+			"string",
+		},
+		"Provide Valid IP address",
+	}}
 };
 
 enum class Index
@@ -1355,6 +1368,7 @@ enum class Index
     success = 101,
     undeterminedFault = 102,
     unrecognizedRequestBody = 103,
-    propertySizeExceeded = 104
+    propertySizeExceeded = 104,
+    invalidip=105
 };
 } // namespace redfish::registries::base
diff --git a/redfish-core/lib/ethernet.hpp b/redfish-core/lib/ethernet.hpp
index e5c765d..82142bb 100644
--- a/redfish-core/lib/ethernet.hpp
+++ b/redfish-core/lib/ethernet.hpp
@@ -813,10 +813,10 @@ inline void
             messages::internalError(asyncResp->res);
         }
         crow::connections::systemBus->async_method_call(
-            [asyncResp](const boost::system::error_code ec2) {
+            [asyncResp,address](const boost::system::error_code ec2) {
             if (ec2)
             {
-                messages::internalError(asyncResp->res);
+               messages::invalidip(asyncResp->res,"Address",address);
             }
             },
             "xyz.openbmc_project.Network",
@@ -844,10 +844,10 @@ inline void createIPv6(const std::string& ifaceId, uint8_t prefixLength,
                        const std::string& address,
                        const std::shared_ptr<bmcweb::AsyncResp>& asyncResp)
 {
-    auto createIpHandler = [asyncResp](const boost::system::error_code ec) {
+    auto createIpHandler = [asyncResp,address](const boost::system::error_code ec) {
         if (ec)
         {
-            messages::internalError(asyncResp->res);
+            messages::invalidip(asyncResp->res,"Address",address);
         }
     };
     // Passing null for gateway, as per redfish spec IPv6StaticAddresses object
diff --git a/redfish-core/src/error_messages.cpp b/redfish-core/src/error_messages.cpp
index ce2214d..184cac8 100644
--- a/redfish-core/src/error_messages.cpp
+++ b/redfish-core/src/error_messages.cpp
@@ -1868,6 +1868,17 @@ void invalidQueryFilter(crow::Response& res)
     addMessageToErrorJson(res.jsonValue, invalidQueryFilter());
 }
 
+nlohmann::json invalidip(std::string_view arg1,std::string_view arg2)
+{
+    return getLog(redfish::registries::base::Index::invalidip,
+                  std::to_array({arg1,arg2}));
+}
+
+void invalidip(crow::Response& res, std::string_view arg1,std::string_view arg2)
+{
+    res.result(boost::beast::http::status::bad_request);
+    addMessageToErrorJson(res.jsonValue,invalidip(arg1,arg2));
+}
 
 } // namespace messages
 
-- 
2.9.5

