From adbcdc07985d9311765daceba750be3968efa1fe Mon Sep 17 00:00:00 2001
From: Sivaprabu Ganesan <sivaprabug@ami.com>
Date: Wed, 23 Nov 2022 15:48:19 +0530
Subject: [PATCH] WEB UI support for NVME Information

Added the WEB UI Page to show the NVMe drive information

Signed-off-by: Sivaprabu Ganesan <sivaprabug@ami.com>
---
 .../AppNavigation/AppNavigationMixin.js       |   8 +
 src/env/components/AppNavigation/intel.js     |   8 +
 src/env/router/intel.js                       |   9 +
 src/locales/en-US.json                        |  31 ++-
 src/router/routes.js                          |   9 +
 src/store/index.js                            |   2 +
 .../NvmeInformation/NvmeInformationStore.js   |  62 ++++++
 src/views/NvmeInformation/NvmeInformation.vue | 208 ++++++++++++++++++
 src/views/NvmeInformation/index.js            |   2 +
 9 files changed, 337 insertions(+), 2 deletions(-)
 create mode 100644 src/store/modules/NvmeInformation/NvmeInformationStore.js
 create mode 100644 src/views/NvmeInformation/NvmeInformation.vue
 create mode 100644 src/views/NvmeInformation/index.js

diff --git a/src/components/AppNavigation/AppNavigationMixin.js b/src/components/AppNavigation/AppNavigationMixin.js
index 42c684a..bae545f 100644
--- a/src/components/AppNavigation/AppNavigationMixin.js
+++ b/src/components/AppNavigation/AppNavigationMixin.js
@@ -7,6 +7,7 @@ import IconSecurity from '@carbon/icons-vue/es/security/16';
 import IconChevronUp from '@carbon/icons-vue/es/chevron--up/16';
 import IconDataBase from '@carbon/icons-vue/es/data--base--alt/16';
 import IconNic from '@carbon/icons-vue/es/network--2/16';
+import IconObjectStorage from '@carbon/icons-vue/es/object-storage/16';
 
 const AppNavigationMixin = {
   components: {
@@ -19,6 +20,7 @@ const AppNavigationMixin = {
     iconExpand: IconChevronUp,
     iconResourceManagement: IconDataBase,
     iconNic: IconNic,
+    iconObjectStorage: IconObjectStorage,
   },
   data() {
     return {
@@ -209,6 +211,12 @@ const AppNavigationMixin = {
           icon: 'iconNic',
           route: '/nic',
         },
+        {
+          id: 'nvmeInformation',
+          label: this.$t('appNavigation.nvmeInformation'),
+          route: '/nvme-information',
+          icon: 'iconObjectStorage',
+        },
       ],
     };
   },
diff --git a/src/env/components/AppNavigation/intel.js b/src/env/components/AppNavigation/intel.js
index 3532382..1d67f6b 100644
--- a/src/env/components/AppNavigation/intel.js
+++ b/src/env/components/AppNavigation/intel.js
@@ -7,6 +7,7 @@ import IconSecurity from '@carbon/icons-vue/es/security/16';
 import IconChevronUp from '@carbon/icons-vue/es/chevron--up/16';
 import IconDataBase from '@carbon/icons-vue/es/data--base--alt/16';
 import IconNic from '@carbon/icons-vue/es/network--2/16';
+import IconObjectStorage from '@carbon/icons-vue/es/object-storage/16';
 
 const AppNavigationMixin = {
   components: {
@@ -19,6 +20,7 @@ const AppNavigationMixin = {
     iconExpand: IconChevronUp,
     iconResourceManagement: IconDataBase,
     iconNic: IconNic,
+    iconObjectStorage: IconObjectStorage,
   },
   data() {
     return {
@@ -204,6 +206,12 @@ const AppNavigationMixin = {
           icon: 'iconNic',
           route: '/nic',
         },
+        {
+          id: 'nvmeInformation',
+          label: this.$t('appNavigation.nvmeInformation'),
+          route: '/nvme-information',
+          icon: 'iconObjectStorage',
+        },
       ],
     };
   },
diff --git a/src/env/router/intel.js b/src/env/router/intel.js
index e871f6b..f98fd1e 100644
--- a/src/env/router/intel.js
+++ b/src/env/router/intel.js
@@ -34,6 +34,7 @@ import Power from '@/views/ResourceManagement/Power';
 import nicInformation from '@/views/Nic';
 import i18n from '@/i18n';
 import Dumps from '@/views/Logs/Dumps';
+import NvmeInformation from '@/views/NvmeInformation';
 
 const routes = [
   {
@@ -307,6 +308,14 @@ const routes = [
           title: i18n.t('appPageTitle.nicInformation'),
         },
       },
+      {
+        path: '/nvme-information',
+        name: 'nvme-information',
+        component: NvmeInformation,
+        meta: {
+          title: i18n.t('appPageTitle.nvmeInformation'),
+        },
+      },
       {
         path: '*',
         name: 'page-not-found',
diff --git a/src/locales/en-US.json b/src/locales/en-US.json
index ace7e06..89f79e4 100644
--- a/src/locales/en-US.json
+++ b/src/locales/en-US.json
@@ -136,7 +136,8 @@
     "pef": "Platform Event Filter",
     "eventFilter": "Event Filter",
     "alertDestination": "Alert Destination",
-    "nicInformation": "NIC Information"
+    "nicInformation": "NIC Information",
+    "nvmeInformation": "@:appPageTitle.nvmeInformation"
   },
   "appPageTitle": {
     "changePassword": "Change password",
@@ -171,7 +172,8 @@
     "smtpSettings": "SMTP Settings",
     "eventFilter": "Event Filter",
     "alertDestination": "Alert Destination",
-    "nicInformation": "NIC Information"
+    "nicInformation": "NIC Information",
+    "nvmeInformation": "NVMe Information"
   },
   "pageChangePassword": {
     "changePassword": "Change password",
@@ -1142,6 +1144,31 @@
       "serverClosedWithErrors": "Server closed with errors"
     }
   },
+  "pageNvmeInformation": {
+    "nvmeSolidStateDrive": "NVMe Solid State Drive State",
+    "nvmeInformation":"NVMe Information",
+    "model": "Model",
+    "serialNumber": "Serial number",
+    "pcie0LinkSpeed": "PCIe 0 Link Speed",
+    "pcie1LinkSpeed": "PCIe 1 Link Speed",
+    "pcie0LinkWidth": "PCIe 0 Link Width",
+    "pcie1LinkWidth": "PCIe 1 Link Width",
+    "nvmePowered": "NVMe Powered",
+    "nvmeFunctional": "NVMe Functional",
+    "nvmeResetRequired": "NVMe Reset Required",
+    "port0PcieLinkActive": "Port 0 PCIe Link Active",
+    "port1PcieLinkActive": "Port 1 PCIe Link Active",
+    "deviceClass": "Device Class",
+    "deviceSubClass": "Device Sub-Class",
+    "deviceProgrammingIntfc": "Device Programming Intfc",
+    "driveLifeConsumed": "Drive Life Consumed",
+    "manufacturer": "Manufacturer",
+    "deviceLocation": "Device Location",
+    "firmwareVersion": "firmware Version",
+    "toast": {
+      "errorShowingNVMeInfo": "Error in displaying NVMe Information"
+    }
+  },
   "countries": {
     "AF": "Afghanistan",
     "AL": "Albania",
diff --git a/src/router/routes.js b/src/router/routes.js
index f779e93..3b4a30e 100644
--- a/src/router/routes.js
+++ b/src/router/routes.js
@@ -36,6 +36,7 @@ import VirtualMedia from '@/views/Operations/VirtualMedia';
 import Power from '@/views/ResourceManagement/Power';
 import i18n from '@/i18n';
 import nicInformation from '@/views/Nic';
+import NvmeInformation from '@/views/NvmeInformation';
 
 const routes = [
   {
@@ -325,6 +326,14 @@ const routes = [
           title: i18n.t('appPageTitle.nicInformation'),
         },
       },
+      {
+        path: '/nvme-information',
+        name: 'nvme-information',
+        component: NvmeInformation,
+        meta: {
+          title: i18n.t('appPageTitle.nvmeInformation'),
+        },
+      },
       {
         path: '*',
         name: 'page-not-found',
diff --git a/src/store/index.js b/src/store/index.js
index d2a6318..10d9937 100644
--- a/src/store/index.js
+++ b/src/store/index.js
@@ -38,6 +38,7 @@ import VirtualMediaStore from './modules/Operations/VirtualMediaStore';
 import KvmStore from './modules/Operations/KvmStore';
 import AlertDestinationStore from './modules/Pef/alertDestinationStore';
 import NicStore from './modules/Nic/Nic';
+import NvmeInformationStore from './modules/NvmeInformation/NvmeInformationStore';
 
 Vue.use(Vuex);
 
@@ -82,6 +83,7 @@ export default new Vuex.Store({
     keyClear: KeyClearStore,
     FactoryDefault: FactoryDefaultStore,
     nic: NicStore,
+    nvme: NvmeInformationStore,
   },
   plugins: [WebSocketPlugin],
 });
diff --git a/src/store/modules/NvmeInformation/NvmeInformationStore.js b/src/store/modules/NvmeInformation/NvmeInformationStore.js
new file mode 100644
index 0000000..48e28e4
--- /dev/null
+++ b/src/store/modules/NvmeInformation/NvmeInformationStore.js
@@ -0,0 +1,62 @@
+import api from '@/store/api';
+import i18n from '@/i18n';
+const NetworkStore = {
+  namespaced: true,
+  state: {
+    nvmeTableData: [],
+  },
+  getters: {
+    nvmeTableData: (state) => state.nvmeTableData,
+  },
+  mutations: {
+    setNvmeTableData: (state, nvmeData) => {
+      state.nvmeTableData = nvmeData;
+    },
+  },
+  actions: {
+    async getNvmeData({ commit }) {
+      return await api
+        .get('/redfish/v1/Systems/system/Storage/Nvme')
+        .then((response) =>
+          response.data.Drives.map((Drives) => Drives['@odata.id'])
+        )
+        .then((drivesIds) =>
+          api.all(drivesIds.map((drives) => api.get(drives)))
+        )
+        .then((drives) => {
+          const nvmeAllData = drives.map((drive, index) => {
+            const nvme = drive.data.Oem.OpenBmc;
+            nvme.Information = 'NVMe Information ' + (index + 1);
+            nvme.Device_Class == 2
+              ? (nvme.Device_Class = 'Mass Storage Device')
+              : nvme.Device_Class == undefined
+              ? (nvme.Device_Class = 'N/A')
+              : (nvme.Device_Class = 'Unknown Base Class');
+            nvme.Device_Sub_Class == 8
+              ? (nvme.Device_Sub_Class = 'Non-volatile Memory Controller')
+              : nvme.Device_Sub_Class == undefined
+              ? (nvme.Device_Sub_Class = 'N/A')
+              : (nvme.Device_Sub_Class = 'Unknown Sub Class');
+            nvme.Device_Programming_Intf == 1
+              ? (nvme.Device_Programming_Intf = 'NVMe Programming Interface')
+              : nvme.Device_Programming_Intf == undefined
+              ? (nvme.Device_Programming_Intf = 'N/A')
+              : (nvme.Device_Programming_Intf =
+                  'Unknown Programming Interface');
+            nvme.Manufacturer = drive.data?.Manufacturer;
+            nvme.Model = drive.data?.Model;
+            nvme.SerialNumber = drive.data?.SerialNumber;
+            return nvme;
+          });
+          commit('setNvmeTableData', nvmeAllData);
+        })
+        .catch(() => {
+          throw new Error(
+            i18n.tc('pageNvmeInformation.toast.errorShowingNVMeInfo')
+          );
+        });
+    },
+  },
+};
+
+export default NetworkStore;
diff --git a/src/views/NvmeInformation/NvmeInformation.vue b/src/views/NvmeInformation/NvmeInformation.vue
new file mode 100644
index 0000000..3ce76be
--- /dev/null
+++ b/src/views/NvmeInformation/NvmeInformation.vue
@@ -0,0 +1,208 @@
+<template>
+  <b-container fluid="xl">
+    <page-title />
+    <b-table
+      id="table-nvme-info"
+      ref="table"
+      class="pad-right"
+      responsive="md"
+      sort-by="id"
+      :fields="fields"
+      :items="tableItems"
+      :empty-text="$t('global.table.emptyMessage')"
+    >
+      <!-- Expand chevron icon -->
+      <template #cell(expandRow)="row">
+        <b-button
+          variant="link"
+          :aria-label="expandRowLabel"
+          :title="expandRowLabel"
+          class="btn-icon-only"
+          @click="toggleRowDetails(row)"
+        >
+          <icon-chevron />
+        </b-button>
+      </template>
+
+      <template #row-details="{ item }">
+        <b-container fluid>
+          <b-row>
+            <b-col>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.model') }}:</dt>
+                <dd>{{ item.Model ? item.Model : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.pcie0LinkSpeed') }}:</dt>
+                <dd>
+                  {{ item.PCIe_0_Link_Speed ? item.PCIe_0_Link_Speed : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.pcie1LinkSpeed') }}:</dt>
+                <dd>
+                  {{ item.PCIe_1_Link_Speed ? item.PCIe_1_Link_Speed : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.nvmePowered') }}:</dt>
+                <dd>{{ item.NVMe_Powered ? item.NVMe_Powered : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.nvmeResetRequired') }}:</dt>
+                <dd>
+                  {{
+                    item.NVMe_Reset_Required ? item.NVMe_Reset_Required : 'N/A'
+                  }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.port0PcieLinkActive') }}:</dt>
+                <dd>
+                  {{
+                    item.Port_0_PCIe_Link_Active
+                      ? item.Port_0_PCIe_Link_Active
+                      : 'N/A'
+                  }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.port1PcieLinkActive') }}:</dt>
+                <dd>
+                  {{
+                    item.Port_1_PCIe_Link_Active
+                      ? item.Port_1_PCIe_Link_Active
+                      : 'N/A'
+                  }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.deviceClass') }}:</dt>
+                <dd>{{ item.Device_Class ? item.Device_Class : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.deviceProgrammingIntfc') }}:</dt>
+                <dd>
+                  {{
+                    item.Device_Programming_Intf
+                      ? item.Device_Programming_Intf
+                      : 'N/A'
+                  }}
+                </dd>
+              </dl>
+            </b-col>
+            <b-col>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.serialNumber') }}:</dt>
+                <dd>{{ item.SerialNumber ? item.SerialNumber : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.pcie0LinkWidth') }}:</dt>
+                <dd>
+                  {{ item.PCIe_0_Link_Width ? item.PCIe_0_Link_Width : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.pcie1LinkWidth') }}:</dt>
+                <dd>
+                  {{ item.PCIe_1_Link_Width ? item.PCIe_1_Link_Width : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.nvmeFunctional') }}:</dt>
+                <dd>
+                  {{ item.NVMe_Functional ? item.NVMe_Functional : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.deviceSubClass') }}:</dt>
+                <dd>
+                  {{ item.Device_Sub_Class ? item.Device_Sub_Class : 'N/A' }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.driveLifeConsumed') }}:</dt>
+                <dd>
+                  {{
+                    item.Drive_Life_Consumed || item.Drive_Life_Consumed == 0
+                      ? item.Drive_Life_Consumed + '%'
+                      : 'N/A'
+                  }}
+                </dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.manufacturer') }}:</dt>
+                <dd>{{ item.Manufacturer ? item.Manufacturer : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.deviceLocation') }}:</dt>
+                <dd>{{ item.DeviceLocation ? item.DeviceLocation : 'N/A' }}</dd>
+              </dl>
+              <dl>
+                <dt>{{ $t('pageNvmeInformation.firmwareVersion') }}:</dt>
+                <dd>
+                  {{ item.Firmware_Version ? item.Firmware_Version : 'N/A' }}
+                </dd>
+              </dl>
+            </b-col>
+          </b-row>
+        </b-container>
+      </template>
+    </b-table>
+  </b-container>
+</template>
+
+<script>
+import BVToastMixin from '@/components/Mixins/BVToastMixin';
+import LoadingBarMixin from '@/components/Mixins/LoadingBarMixin';
+import IconChevron from '@carbon/icons-vue/es/chevron--down/20';
+import PageTitle from '@/components/Global/PageTitle';
+import TableRowExpandMixin, {
+  expandRowLabel,
+} from '@/components/Mixins/TableRowExpandMixin';
+
+export default {
+  name: 'VlanListTable',
+  components: {
+    IconChevron,
+    PageTitle,
+  },
+  mixins: [BVToastMixin, LoadingBarMixin, TableRowExpandMixin],
+  props: {
+    tabId: {
+      type: String,
+      default: '',
+    },
+  },
+  data() {
+    return {
+      tableItems: [],
+      fields: [
+        {
+          key: 'Information',
+          label: this.$t('pageNvmeInformation.nvmeSolidStateDrive'),
+        },
+        {
+          key: 'expandRow',
+          label: '',
+          tdClass: 'table-row-expand',
+        },
+      ],
+      expandRowLabel,
+    };
+  },
+  created() {
+    this.startLoader();
+    this.$store.dispatch('nvme/getNvmeData').finally(() => {
+      this.tableItems = this.$store.getters['nvme/nvmeTableData'];
+      this.endLoader();
+    });
+  },
+  methods: {},
+};
+</script>
+<style>
+.pad-right .table .b-table-details td {
+  padding-right: 10px !important;
+}
+</style>
diff --git a/src/views/NvmeInformation/index.js b/src/views/NvmeInformation/index.js
new file mode 100644
index 0000000..49138fe
--- /dev/null
+++ b/src/views/NvmeInformation/index.js
@@ -0,0 +1,2 @@
+import NvmeInformation from './NvmeInformation.vue';
+export default NvmeInformation;
-- 
2.25.1

